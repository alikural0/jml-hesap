<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>JML Dış Ticaret</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#14161a">
  <link rel="apple-touch-icon" href="./icon-192.png">

  <style>
    :root{
      --bg:#111216;
      --bg2:#0e0f12;
      --card:rgba(255,255,255,.075);
      --card2:rgba(255,255,255,.04);
      --stroke:rgba(255,255,255,.16);
      --stroke2:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.93);
      --muted:rgba(255,255,255,.66);
      --muted2:rgba(255,255,255,.48);
      --r:18px;
      --shadow:0 26px 90px rgba(0,0,0,.68);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      min-height:100vh;
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(900px 600px at 20% 15%, rgba(255,255,255,.08), transparent 60%),
        radial-gradient(900px 600px at 80% 85%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      display:flex; justify-content:center;
      padding:22px 12px;
    }
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      opacity:.13;
    }

    .wrap{width:min(600px,100%); display:flex; flex-direction:column; gap:12px; position:relative; z-index:1}

    .topbar{
      position:relative;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:14px;
      border-radius:var(--r);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border:1px solid var(--stroke2);
      box-shadow:var(--shadow);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }
    .brand{display:flex; align-items:center; gap:12px; min-width:0}
    .brand img{
      height:40px; width:auto;
      background:#fff;
      border-radius:12px;
      padding:6px 8px;
      border:1px solid rgba(0,0,0,.08);
      box-shadow:0 10px 28px rgba(0,0,0,.35);
      flex:0 0 auto;
      image-rendering:-webkit-optimize-contrast;
    }
    .brand .text{display:flex; flex-direction:column; min-width:0}
    .brand b{
      font-size:14px; letter-spacing:.9px; font-weight:850;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .brand span{
      margin-top:3px;
      font-size:11px; letter-spacing:1.1px; text-transform:uppercase;
      color:var(--muted2);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .right{display:flex; align-items:center; gap:10px}

    .menuBtn{
      height:34px; width:42px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.10);
      color:#fff;
      font-size:18px;
      cursor:pointer;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.10);
      touch-action:manipulation;
    }
    .menuBtn:active{transform:scale(.98)}

    .sel{
      height:34px; border-radius:999px;
      background:rgba(255,255,255,.08);
      border:1px solid var(--stroke2);
      color:var(--text);
      padding:0 10px;
      outline:none;
      cursor:pointer;
      font-size:12px;
    }
    .chip{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--stroke2);
      background:rgba(255,255,255,.06);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
      user-select:none;
    }

    .menuBackdrop{
      display:none;
      position:fixed; inset:0;
      background:rgba(0,0,0,.35);
      backdrop-filter: blur(2px);
      z-index:50;
    }
    .menuBackdrop.open{display:block}

    .menu{
      position:absolute;
      top:64px;
      right:12px;
      width:250px;
      padding:10px;
      border-radius:18px;
      background:rgba(26,28,33,.96);
      border:1px solid var(--stroke2);
      box-shadow:0 34px 90px rgba(0,0,0,.75);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      display:none;
      z-index:60;
    }
    .menu.open{display:block}
    .menu .mTitle{
      padding:10px 10px 8px;
      font-size:12px;
      color:var(--muted2);
      letter-spacing:.9px;
      text-transform:uppercase;
    }
    .menu button{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid transparent;
      background:transparent;
      color:var(--text);
      text-align:left;
      font-size:14px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .menu button:hover{
      background:rgba(255,255,255,.09);
      border-color:rgba(255,255,255,.10);
    }
    .menu button.active{
      background:rgba(255,255,255,.13);
      border-color:rgba(255,255,255,.16);
    }
    .menu small{color:var(--muted2); font-size:12px}

    .card{
      border-radius:var(--r);
      background:linear-gradient(180deg, rgba(255,255,255,.085), rgba(255,255,255,.03));
      border:1px solid var(--stroke2);
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    .panel{display:none; padding:14px}
    .panel.active{display:block}

    .screen{
      width:100%; height:76px;
      border-radius:16px;
      border:1px solid var(--stroke2);
      background:rgba(0,0,0,.30);
      color:var(--text);
      padding:12px 14px;
      text-align:right;
      font-size:30px;
      outline:none;
    }
    .subline{
      margin-top:8px;
      display:flex; justify-content:space-between;
      flex-wrap:wrap; gap:10px;
      font-size:12px;
      color:var(--muted2);
    }

    .grid{
      margin-top:12px;
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
      touch-action:manipulation;
      user-select:none;
    }
    button.key{
      height:56px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.13);
      background:rgba(255,255,255,.085);
      color:var(--text);
      font-size:18px;
      cursor:pointer;
      transition:.10s transform,.10s background,.10s border-color;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.12),
        0 14px 36px rgba(0,0,0,.38);
      touch-action:manipulation;
    }
    button.key:hover{transform:translateY(-1px); background:rgba(255,255,255,.11); border-color:rgba(255,255,255,.18)}
    button.key:active{transform:translateY(0) scale(.99)}
    .op{background:rgba(255,255,255,.095)}
    .danger{background:rgba(255,255,255,.10)}
    .good{background:rgba(255,255,255,.16); border-color:rgba(255,255,255,.22)}
    .wide{grid-column:span 2}
    .eq{grid-column:span 2}

    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .field{
      flex:1; min-width:150px;
      height:44px;
      border-radius:14px;
      border:1px solid var(--stroke2);
      background:rgba(0,0,0,.26);
      color:var(--text);
      padding:0 12px;
      outline:none;
    }
    .btn{
      height:44px;
      padding:0 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.08);
      color:var(--text);
      cursor:pointer;
      transition:.10s transform,.10s background;
      font-size:13px;
      white-space:nowrap;
      touch-action:manipulation;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.10);
    }
    .btn:hover{transform:translateY(-1px); background:rgba(255,255,255,.11)}
    .btn:active{transform:translateY(0) scale(.99)}

    .out{
      margin-top:10px;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid var(--stroke2);
      background:
        radial-gradient(800px 320px at 15% 0%, rgba(255,255,255,.10), transparent 60%),
        rgba(0,0,0,.22);
      font-size:13px;
      color:rgba(255,255,255,.90);
      line-height:1.55;
      word-break:break-word;
    }
    .hint{margin-top:10px; font-size:12px; color:var(--muted2); line-height:1.45}
    .listItem{border-bottom:1px solid rgba(255,255,255,.08); padding:10px 0}
    .listItem:last-child{border-bottom:none}

    @media (max-width:420px){
      .brand img{height:36px}
      .chip{display:none}
      .screen{font-size:26px; height:72px}
      button.key{height:54px}
      .menu{right:10px; width:min(92vw, 280px)}
    }
  </style>
</head>

<body>
  <div class="menuBackdrop" id="menuBackdrop"></div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <img src="logo.png" alt="JML Dış Ticaret">
        <div class="text">
          <b>JML DIŞ TİCARET</b>
          <span>V5.0 • HESAP • KDV • YÜZDE • KAR/ZARAR • KUR • İHRACAT • ZAM • YORUMLAR</span>
        </div>
      </div>

      <div class="right">
        <button id="menuBtn" class="menuBtn" aria-label="Menü">☰</button>
        <select id="currency" class="sel" title="Gösterim para birimi">
          <option value="TRY" selected>₺ TL</option>
          <option value="USD">$ USD</option>
        </select>
        <div class="chip">Mobil: Dokun • Enter: =</div>
      </div>

      <!-- Menü -->
      <div class="menu" id="menu">
        <div class="mTitle">Menü</div>
        <button data-tab="calc" class="active">Hesap <small>Temel</small></button>
        <button data-tab="kdv">KDV <small>Net/Brüt</small></button>
        <button data-tab="pct">Yüzde <small>+ / −</small></button>
        <button data-tab="profit">Kar / Zarar <small>Marj</small></button>
        <button data-tab="fx">Kur <small>Manuel</small></button>
        <button data-tab="export">İhracat <small>FOB/CIF</small></button>
        <button data-tab="raise">Zam Hesaplama <small>Oran</small></button>
        <button data-tab="comments">Yorumlar <small>Firebase</small></button>
      </div>
    </div>

    <div class="card">
      <!-- HESAP -->
      <div class="panel active" id="panel-calc">
        <input id="screen" class="screen" value="0" readonly />
        <div class="subline">
          <span>⌫ Backspace • C Esc</span>
          <span id="miniInfo">—</span>
        </div>

        <div class="grid" id="grid">
          <button class="key danger" data-action="clear" type="button">C</button>
          <button class="key danger" data-action="back" type="button">⌫</button>
          <button class="key op" data-value="%" type="button">%</button>
          <button class="key op" data-value="/" type="button">÷</button>

          <button class="key" data-value="7" type="button">7</button>
          <button class="key" data-value="8" type="button">8</button>
          <button class="key" data-value="9" type="button">9</button>
          <button class="key op" data-value="*" type="button">×</button>

          <button class="key" data-value="4" type="button">4</button>
          <button class="key" data-value="5" type="button">5</button>
          <button class="key" data-value="6" type="button">6</button>
          <button class="key op" data-value="-" type="button">−</button>

          <button class="key" data-value="1" type="button">1</button>
          <button class="key" data-value="2" type="button">2</button>
          <button class="key" data-value="3" type="button">3</button>
          <button class="key op" data-value="+" type="button">+</button>

          <button class="key wide" data-value="0" type="button">0</button>
          <button class="key" data-value="." type="button">.</button>
          <button class="key good eq" data-action="equals" type="button">=</button>
        </div>

        <div class="hint">Para birimi seçimi (₺/$) gösterim içindir. Binlik ayracı otomatik.</div>
      </div>

      <!-- KDV -->
      <div class="panel" id="panel-kdv">
        <div class="row">
          <select id="kdvRate" class="field" style="min-width:160px; flex:0 0 auto">
            <option value="1">KDV 1%</option>
            <option value="8">KDV 8%</option>
            <option value="10">KDV 10%</option>
            <option value="18" selected>KDV 18%</option>
            <option value="20">KDV 20%</option>
          </select>
          <button class="btn" id="netToBrut" type="button">Net → Brüt</button>
          <button class="btn" id="brutToNet" type="button">Brüt → Net</button>
        </div>
        <div class="out" id="kdvOut">Ekrandaki sayı üzerinden hesaplar.</div>
      </div>

      <!-- YÜZDE -->
      <div class="panel" id="panel-pct">
        <div class="row">
          <input id="baseA" class="field" type="text" inputmode="decimal" placeholder="A (taban) örn: 1.250,50" />
          <input id="percB" class="field" type="text" inputmode="decimal" placeholder="B (%) örn: 18" />
        </div>
        <div class="row">
          <button class="btn" id="aOfB" type="button">A'nın %B'si</button>
          <button class="btn" id="aPlusB" type="button">A + %B</button>
          <button class="btn" id="aMinusB" type="button">A - %B</button>
        </div>
        <div class="out" id="percOut">A ve B girip hesapla.</div>
        <div class="hint">TR (1.234,56) ve US (1,234.56) formatı otomatik anlaşılır.</div>
      </div>

      <!-- KAR/ZARAR -->
      <div class="panel" id="panel-profit">
        <div class="row">
          <input id="cost" class="field" type="text" inputmode="decimal" placeholder="Maliyet" />
          <input id="sell" class="field" type="text" inputmode="decimal" placeholder="Satış" />
        </div>
        <div class="row">
          <button class="btn" id="profitCalc" type="button">Hesapla</button>
          <button class="btn" id="swap" type="button">Yer değiştir</button>
        </div>
        <div class="out" id="profitOut">Maliyet ve satış girip “Hesapla”.</div>
        <div class="hint">Kâr = Satış − Maliyet • Kâr% (maliyet) • Marj% (satış)</div>
      </div>

      <!-- KUR -->
      <div class="panel" id="panel-fx">
        <div class="row">
          <input id="fxRate" class="field" type="text" inputmode="decimal" placeholder="Kur (örn: 35,50) — 1 USD/EUR = ? TRY" />
          <button class="btn" id="fxUseUSDTRY" type="button">USD/TRY</button>
          <button class="btn" id="fxUseEURTRY" type="button">EUR/TRY</button>
        </div>

        <div class="row" style="margin-top:10px">
          <input id="fxAmount" class="field" type="text" inputmode="decimal" placeholder="Tutar (örn 1000)" />
          <select id="fxFrom" class="field" style="min-width:140px; flex:0 0 auto">
            <option value="USD" selected>USD</option>
            <option value="TRY">TRY</option>
            <option value="EUR">EUR</option>
          </select>
          <select id="fxTo" class="field" style="min-width:140px; flex:0 0 auto">
            <option value="TRY" selected>TRY</option>
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
          </select>
          <button class="btn" id="fxConvert" type="button">Çevir</button>
        </div>

        <div class="out" id="fxOut">Kur girip çevir yapabilirsin.</div>
        <div class="hint">TCMB otomatik kur: sonraki güncelleme (CORS/Actions).</div>
      </div>

      <!-- İHRACAT -->
      <div class="panel" id="panel-export">
        <div class="row">
          <select id="incoterm" class="field" style="min-width:160px; flex:0 0 auto">
            <option value="FOB" selected>FOB</option>
            <option value="CFR">CFR</option>
            <option value="CIF">CIF</option>
            <option value="EXW">EXW</option>
          </select>

          <select id="expCur" class="field" style="min-width:140px; flex:0 0 auto">
            <option value="USD" selected>USD</option>
            <option value="EUR">EUR</option>
            <option value="GBP">GBP</option>
            <option value="TRY">TRY</option>
          </select>
        </div>

        <div class="row" style="margin-top:10px">
          <input id="goodsValue" class="field" type="text" inputmode="decimal" placeholder="Mal bedeli (örn 25000)" />
          <input id="freight" class="field" type="text" inputmode="decimal" placeholder="Navlun (örn 1200)" />
          <input id="insurance" class="field" type="text" inputmode="decimal" placeholder="Sigorta (örn 150)" />
        </div>

        <div class="row" style="margin-top:10px">
          <input id="inland" class="field" type="text" inputmode="decimal" placeholder="İç nakliye (örn 300)" />
          <input id="portFees" class="field" type="text" inputmode="decimal" placeholder="Liman masrafı (örn 200)" />
          <input id="commissionPct" class="field" type="text" inputmode="decimal" placeholder="Komisyon % (örn 2.5)" />
        </div>

        <div class="row" style="margin-top:10px">
          <input id="qty" class="field" type="text" inputmode="decimal" placeholder="Miktar (örn 3000)" />
          <input id="unitPrice" class="field" type="text" inputmode="decimal" placeholder="Birim fiyat (opsiyonel)" />
          <button class="btn" id="expCalc" type="button">Maliyet Hesapla</button>
        </div>

        <div class="row" style="margin-top:10px">
          <select id="profitBase" class="field" style="min-width:180px; flex:0 0 auto">
            <option value="FOB" selected>Hedef satış baz: FOB</option>
            <option value="CIF">Hedef satış baz: CIF</option>
          </select>
          <input id="targetProfitPct" class="field" type="text" inputmode="decimal" placeholder="Hedef kâr % (örn 12)" />
          <button class="btn" id="priceWithProfit" type="button">Satış Fiyatı</button>
        </div>

        <div class="out" id="expOut">FOB/CFR/CIF + masraflar + hedef satış burada.</div>
        <div class="hint">CFR = FOB + Navlun • CIF = CFR + Sigorta</div>
      </div>

      <!-- ZAM HESAPLAMA -->
      <div class="panel" id="panel-raise">
        <div class="row">
          <input id="oldSalary" class="field" type="text" inputmode="decimal" placeholder="Mevcut maaş" />
          <input id="newSalary" class="field" type="text" inputmode="decimal" placeholder="Yeni maaş" />
        </div>
        <div class="row" style="margin-top:10px">
          <button class="btn" id="raiseCalc" type="button">Zam Hesapla</button>
        </div>
        <div class="out" id="raiseOut">Maaşları gir.</div>
        <div class="hint">
          %20: “Ağanın Eli tutulmaz” • %30+: “Personel mutlu, enflasyon düşünsün” • %40+: “Personel çıldırdı ofisten çıkmıyor” • %50+: “Moris bey iyi misiniz?”
        </div>
      </div>

      <!-- YORUMLAR -->
      <div class="panel" id="panel-comments">
        <div class="row">
          <input id="cName" class="field" type="text" placeholder="İsim (opsiyonel)" />
        </div>

        <div class="row" style="margin-top:10px">
          <input id="cText" class="field" type="text" maxlength="500" placeholder="Yorum yaz (max 500 karakter)..." />
          <button class="btn" id="cSend" type="button">Gönder</button>
        </div>

        <div class="out" id="cStatus">Bağlanıyor…</div>
        <div class="out" id="cList" style="margin-top:10px">Yorumlar yükleniyor…</div>

        <div class="hint">Yorumlar Firebase’de tutulur ve anlık güncellenir.</div>
      </div>
    </div>
  </div>

  <script src="./app.js" defer></script>
  <script type="module" src="./firebase-comments.js"></script>
</body>
</html>
